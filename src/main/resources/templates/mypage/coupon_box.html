<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>쿠폰함 - 마이페이지</title>
  <th:block th:replace="~{fragments/file_link :: linkInfo}"></th:block>
</head>
<body class="account-page">
<div th:replace="~{fragments/common_header :: commonHeader}"></div>
<main class="main">
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">쿠폰함</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a th:href="@{/}">홈</a></li>
          <li><a th:href="@{/mypage}">마이페이지</a></li>
          <li class="current">쿠폰함</li>
        </ol>
      </nav>
    </div>
  </div>

  <section id="account" class="account section">

    <div class="container" data-aos="fade-up" data-aos-delay="100">

      <div class="mobile-menu d-lg-none mb-4">
        <button class="mobile-menu-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#profileMenu">
          <i class="bi bi-grid"></i>
          <span>Menu</span>
        </button>
      </div>

      <div class="row g-4">
        <div class="col-lg-3">
          <div th:replace="~{fragments/mypage_profile :: mypage_profile}"></div>
        </div>

        <div class="col-lg-9">
          <div class="content-area">
            <div id="coupons">
              <div class="section-header" data-aos="fade-up">
                <h2>쿠폰함</h2>
              </div>

              <ul class="nav nav-tabs coupon-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="issued-tab" data-bs-toggle="tab" data-bs-target="#issued" type="button" role="tab">
                    발급 내역
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="used-tab" data-bs-toggle="tab" data-bs-target="#used" type="button" role="tab">
                    사용 내역
                  </button>
                </li>
              </ul>

              <div class="tab-content">

                <div class="tab-pane fade show active" id="issued" role="tabpanel">

                  <div th:if="${#lists.isEmpty(issuedCoupons)}" class="empty-state">
                    <i class="bi bi-ticket-perforated"></i>
                    <h4>발급된 쿠폰이 없습니다</h4>
                    <p>현재 사용 가능한 쿠폰이 없습니다.</p>
                  </div>

                  <div th:if="${!#lists.isEmpty(issuedCoupons)}">
                    <table class="coupon-table">
                      <thead>
                      <tr>
                        <th>쿠폰명</th>
                        <th>할인 정보</th>
                        <th>기준 금액</th>
                        <th>발급 일자</th>
                        <th>만료 일자</th>
                        <th>상태</th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr th:each="coupon : ${issuedCoupons}">
                        <td>
                          <div class="coupon-name" th:text="${coupon.couponName}">신규 회원 웰컴 쿠폰</div>
                          <div class="coupon-discount-info" th:text="${coupon.couponPolicyType}">도서 쿠폰</div>
                        </td>
                        <td>
                          <div class="coupon-discount">
                            <span th:text="${coupon.discount}">10%</span>
                            <span th:if="${coupon.discountLimit != null}"
                                  class="coupon-discount-info"
                                  th:text="'(최대 ' + ${#numbers.formatDecimal(coupon.discountLimit, 0, 'COMMA', 0, 'POINT')} + '원)'">
                                (최대 5,000원)
                              </span>
                          </div>
                        </td>
                        <td>
                            <span th:text="${#numbers.formatDecimal(coupon.criterionPrice, 0, 'COMMA', 0, 'POINT')} + '원 이상'">
                              30,000원 이상
                            </span>
                        </td>
                        <td>
                          <div class="date-info" th:text="${#temporals.format(coupon.createdDate, 'yyyy-MM-dd')}">2025-01-01</div>
                        </td>
                        <td>
                          <div class="date-info" th:text="${#temporals.format(coupon.expiredDate, 'yyyy-MM-dd')}">2025-01-31</div>
                        </td>
                        <td>
                          <span th:if="${coupon.status}" class="coupon-status status-available">사용 가능</span>
                          <span th:unless="${coupon.status}" class="coupon-status status-expired">기한 만료</span>
                        </td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div class="tab-pane fade" id="used" role="tabpanel">

                  <div th:if="${#lists.isEmpty(usedCoupons)}" class="empty-state">
                    <i class="bi bi-check-circle"></i>
                    <h4>사용한 쿠폰이 없습니다</h4>
                    <p>사용한 쿠폰 내역이 여기에 표시됩니다.</p>
                  </div>

                  <div th:if="${!#lists.isEmpty(usedCoupons)}">
                    <table class="coupon-table">
                      <thead>
                      <tr>
                        <th>쿠폰명</th>
                        <th>할인 정보</th>
                        <th>기준 금액</th>
                        <th>발급 일자</th>
                        <th>사용 일자</th>
                        <th>상태</th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr th:each="coupon : ${usedCoupons}">
                        <td>
                          <div class="coupon-name" th:text="${coupon.couponName}">일반 쿠폰</div>
                          <div class="coupon-discount-info" th:text="${coupon.couponPolicyType}">도서 쿠폰</div>
                        </td>
                        <td>
                          <div class="coupon-discount">
                            <span th:text="${coupon.discount}">10%</span>
                            <span th:if="${coupon.discountLimit != null}"
                                  class="coupon-discount-info"
                                  th:text="'(최대 ' + ${#numbers.formatDecimal(coupon.discountLimit, 0, 'COMMA', 0, 'POINT')} + '원)'">
                                (최대 5,000원)
                              </span>
                          </div>
                        </td>
                        <td>
                            <span th:text="${#numbers.formatDecimal(coupon.criterionPrice, 0, 'COMMA', 0, 'POINT')} + '원 이상'">
                              10,000원 이상
                            </span>
                        </td>
                        <td>
                          <div class="date-info" th:text="${#temporals.format(coupon.createdDate, 'yyyy-MM-dd')}">2025-01-15</div>
                        </td>
                        <td>
                          <div class="date-info" th:text="${#temporals.format(coupon.usedAt, 'yyyy-MM-dd HH:mm')}">2025-01-20 14:30</div>
                        </td>
                        <td>
                          <span class="coupon-status status-used">사용됨</span>
                        </td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

              </div> </div>
          </div>
        </div>
      </div>

    </div>

  </section></main>
<div th:replace="~{fragments/common_footer :: commonFooter}"></div>
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
<div id="preloader"></div>

<!-- Vendor & Main JS Files -->
<th:block th:replace="~{fragments/common_scripts :: commonScripts}"></th:block>

<!-- Grade Modal Fragment -->
<div th:replace="~{fragments/grade_modal :: grade_modal}"></div>

</body>
</html>