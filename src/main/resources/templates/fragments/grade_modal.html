<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="grade_modal">
    <!-- Grade Modal -->
    <div id="gradeModal" class="grade-modal" style="display: none;">
        <div class="grade-modal-backdrop" onclick="closeGradeModal()"></div>
        <div class="grade-modal-dialog">
            <div class="grade-modal-content">
                <div class="grade-modal-header">
                    <h5 class="grade-modal-title">등급 정보</h5>
                    <button type="button" class="grade-modal-close" onclick="closeGradeModal()" aria-label="Close">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="grade-modal-body">
                    <ul class="list-group" th:if="${member.grades != null and !member.grades.isEmpty()}">
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            th:each="grade : ${member.grades}">
                            <div>
                                <strong th:text="${grade.gradeName}">GOLD</strong><br>
                                <small>
                                    기준 금액:
                                    <span th:text="${grade.criterionPrice}">100000</span> 원
                                </small>
                            </div>
                            <span th:text="${grade.pointRate * 100} + '%'">5%</span>
                        </li>
                    </ul>
                    <p class="text-muted" th:if="${member.grades == null or member.grades.isEmpty()}">
                        등록된 등급 정보가 없습니다.
                    </p>
                </div>
                <div class="grade-modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeGradeModal()">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grade Modal Styles -->
    <style>
        .grade-modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            min-width: 100vw !important;
            min-height: 100vh !important;
            z-index: 100000 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow-y: auto !important;
        }
        
        .grade-modal.show {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .grade-modal-backdrop {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            min-width: 100vw !important;
            min-height: 100vh !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            z-index: 99999 !important;
            backdrop-filter: blur(2px);
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .grade-modal-dialog {
            position: relative !important;
            z-index: 100001 !important;
            width: 90%;
            max-width: 500px;
            margin: 2rem auto;
            max-height: calc(100vh - 4rem);
            display: flex;
            align-items: center;
        }
        
        .grade-modal-content {
            position: relative;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-height: calc(100vh - 4rem);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .grade-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem;
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0;
        }
        
        .grade-modal-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .grade-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            transition: color 0.2s;
        }
        
        .grade-modal-close:hover {
            color: #000;
        }
        
        .grade-modal-body {
            padding: 1.25rem;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }
        
        .grade-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 1rem 1.25rem;
            border-top: 1px solid #dee2e6;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        body.grade-modal-open {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        .grade-modal.show .grade-modal-content {
            animation: gradeModalFadeIn 0.3s ease-out;
        }
        
        @keyframes gradeModalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 576px) {
            .grade-modal-dialog {
                width: 95%;
                margin: 1rem auto;
                max-height: calc(100vh - 2rem);
            }
            
            .grade-modal-content {
                max-height: calc(100vh - 2rem);
            }
        }
    </style>

    <!-- Grade Modal JavaScript -->
    <script>
        (function() {
            let savedScrollPosition = 0;
            let escapeKeyHandler = null;
            
            window.openGradeModal = function() {
                const modal = document.getElementById('gradeModal');
                if (!modal) return;
                
                savedScrollPosition = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                document.body.style.top = `-${savedScrollPosition}px`;
                document.body.classList.add('grade-modal-open');
                modal.classList.add('show');
                modal.style.display = 'flex';
                
                escapeKeyHandler = function(event) {
                    if (event.key === 'Escape' || event.keyCode === 27) {
                        closeGradeModal();
                    }
                };
                document.addEventListener('keydown', escapeKeyHandler);
            };
            
            window.closeGradeModal = function() {
                const modal = document.getElementById('gradeModal');
                if (!modal) return;
                
                modal.classList.remove('show');
                modal.style.display = 'none';
                document.body.classList.remove('grade-modal-open');
                document.body.style.top = '';
                window.scrollTo(0, savedScrollPosition);
                savedScrollPosition = 0;
                
                if (escapeKeyHandler) {
                    document.removeEventListener('keydown', escapeKeyHandler);
                    escapeKeyHandler = null;
                }
            };
        })();
    </script>
</th:block>

