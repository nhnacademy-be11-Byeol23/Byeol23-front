<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<body>
<th:block th:fragment="couponPolicyTypeJs">
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const rateRadio = document.getElementById('rateDiscount');
            const fixedRadio = document.getElementById('fixedDiscount');

            const rateOptions = document.getElementById('rateOptions');
            const fixedOptions = document.getElementById('fixedOptions');

            const discountRateInput = document.getElementById('discountRate');
            const discountLimitInput = document.getElementById('discountLimit');
            const discountAmountInput = document.getElementById('discountAmount');

            function toggleDiscountOptions() {
                if (rateRadio.checked) {
                    rateOptions.style.display = 'block';
                    fixedOptions.style.display = 'none';

                    if (discountRateInput) discountRateInput.disabled = false;
                    if (discountLimitInput) discountLimitInput.disabled = false;

                    if (discountAmountInput) {
                        discountAmountInput.disabled = true;
                        discountAmountInput.value = '';
                    }
                } else if (fixedRadio.checked) {
                    rateOptions.style.display = 'none';
                    fixedOptions.style.display = 'block';

                    if (discountRateInput) {
                        discountRateInput.disabled = true;
                        discountRateInput.value = '';
                    }
                    if (discountLimitInput) {
                        discountLimitInput.disabled = true;
                        discountLimitInput.value = '';
                    }

                    if (discountAmountInput) discountAmountInput.disabled = false;
                }
            }

            if (rateRadio) {
                rateRadio.addEventListener('change', toggleDiscountOptions);
            }
            if (fixedRadio) {
                fixedRadio.addEventListener('change', toggleDiscountOptions);
            }

            toggleDiscountOptions();

            // 폼 유효성 검사 로직은 그대로 유지
            const form = document.querySelector('form[action="/admin/coupon-policy"]');

            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const discountType = document.querySelector('input[name="discountType"]:checked').value;
                const discountRate = document.getElementById('discountRate').value;
                const discountLimit = document.getElementById('discountLimit').value;
                const discountAmount = document.getElementById('discountAmount').value;

                let isValid = false;
                let alertMessage = '';

                if (discountType === 'RATE') {
                    if (discountRate && discountLimit) {
                        isValid = true;
                    } else {
                        alertMessage = '할인률(%)과 최대 할인 금액(원)을 모두 입력해주세요.';
                    }
                } else if (discountType === 'FIXED') {
                    if (discountAmount) {
                        isValid = true;
                    } else {
                        alertMessage = '할인액(원)을 입력주세요.';
                    }
                }

                if (isValid) {
                    event.target.submit();
                } else {
                    alert(alertMessage);
                }
            });

            // '취소' 버튼(type="reset")은 폼 필드만 초기화합니다.
            // 만약 라디오 버튼 등 JS로 제어되는 항목의 초기화가 필요하면 여기에 추가합니다.
            form.addEventListener('reset', function() {
                // 라디오 버튼을 '정률 할인'으로, 폼 표시를 초기 상태로 되돌림
                document.getElementById('rateDiscount').checked = true;
                document.getElementById('fixedDiscount').checked = false;
                document.getElementById('rateOptions').style.display = 'flex'; // row는 flex
                document.getElementById('fixedOptions').style.display = 'none';
            });


        });


    </script>
</th:block>

</body>
</html>
