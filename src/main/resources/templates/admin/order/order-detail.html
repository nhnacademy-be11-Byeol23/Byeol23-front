<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:if="${orderDetail != null}">

  <div class="mb-3">
    <h6>기본 정보</h6>
    <p class="mb-1"><strong>주문 번호:</strong> <span th:text="${orderDetail.orderNumber ?: 'N/A'}"></span></p>
    <p class="mb-1"><strong>주문 일시:</strong> <span th:text="${orderDetail.orderDate != null ? #temporals.format(orderDetail.orderDate, 'yyyy-MM-dd HH:mm:ss') : 'N/A'}"></span></p>
    <p class="mb-1"><strong>주문 상태:</strong>
      <span class="badge"
            th:classappend="${orderDetail.orderStatus == '결제 완료'} ? 'text-bg-success' :
                           (${orderDetail.orderStatus == '배송중'} ? 'text-bg-primary' :
                           (${orderDetail.orderStatus == '주문 취소'} ? 'text-bg-danger' : 'text-bg-secondary'))"
            th:text="${orderDetail.orderStatus ?: 'N/A'}"></span>
    </p>
    <p class="mb-0"><strong>결제 금액:</strong> <span th:text="${orderDetail.actualOrderPrice != null ? #numbers.formatInteger(orderDetail.actualOrderPrice, 0, 'COMMA') + '원' : 'N/A'}"></span></p>
  </div>

  <hr>

  <div class="mb-3">
    <h6>수신자 정보</h6>
    <p class="mb-1"><strong>이름:</strong> <span th:text="${orderDetail.receiver ?: 'N/A'}"></span></p>
    <p class="mb-1"><strong>연락처:</strong> <span th:text="${orderDetail.receiverPhone ?: 'N/A'}"></span></p>
    <p class="mb-0"><strong>주소:</strong>
      <span th:text="${orderDetail.receiverAddress ?: ''}"></span>
      <span th:text="${orderDetail.receiverAddressDetail ?: ''}"></span>
      (<span th:text="${orderDetail.postCode ?: 'N/A'}"></span>)
    </p>
  </div>

  <hr>

  <div>
    <h6>주문 상품</h6>
    <div class="order-items-list">
      <div th:if="${orderDetail.items != null and not #lists.isEmpty(orderDetail.items)}">

        <div class="item-row"
             th:each="item : ${orderDetail.items()}">

          <div class="item-image me-3">
            <img src="/assets/img/book_placeholder.png" alt="Book" style="width: 60px; height: 80px; object-fit: cover;">
          </div>

          <div class="item-info-group">

            <h5 class="mb-1" th:text="${item.bookTitle()}">도서 제목</h5>

            <div class="item-metadata d-flex small mb-0 align-items-center">
              <span class="text-muted me-3">수량: <span th-text="${item.quantity()}">1</span>권</span>

              <th:block th-if="${item.packaging() != null}">
                <span class="text-muted mx-1">|</span>
                <i class="bi bi-gift-fill me-1 text-success"></i>
                <span th-text="${item.packaging().packagingName()}" class="fw-semibold">프리미엄 포장</span>
              </th:block>
            </div>
          </div>

          <div class="item-price ms-auto fw-bold">
            <span th:text="${#numbers.formatCurrency(item.price() * item.quantity())}">₩15,000</span>
          </div>
        </div>

      </div>

      <div th:if="${orderDetail.items == null or #lists.isEmpty(orderDetail.items)}"
           class="list-group-item text-muted text-center py-3">
        주문 상품 정보가 없습니다.
      </div>

    </div>
  </div>
  <div class="detail-section">
    <h4>결제 상세 내역</h4>
    <div class="summary-grid">

      <div class="info-row d-flex justify-content-between mb-1">
        <span class="label">상품 합계:</span>
        <span class="value text-end" th:text="${#numbers.formatCurrency(subTotal)}">₩30,000</span>
      </div>

      <div class="info-row d-flex justify-content-between mb-1" th:if="${packagingTotal != null and packagingTotal > 0}">
        <span class="label">포장비:</span>
        <span class="value text-end" th:text="${#numbers.formatCurrency(packagingTotal)}">₩0</span>
      </div>

      <div class="info-row d-flex justify-content-between mb-1">
        <span class="label">배송비:</span>
        <span class="value text-end" th:text="${#numbers.formatCurrency(appliedFee)}">₩0</span>
      </div>

      <th:block th:if="${pointDiscount > 0}">
        <div class="info-row d-flex justify-content-between mb-1">
          <span class="label text-danger">포인트 할인:</span>
          <span class="value text-end text-danger" th:text="'-' + ${#numbers.formatCurrency(pointDiscount)}">₩0</span>
        </div>
      </th:block>

      <hr class="my-2">

      <div class="info-row d-flex justify-content-between">
        <span class="label fw-bold">총 결제 금액:</span>
        <span class="value text-end fw-bold text-primary" th:text="${#numbers.formatCurrency(orderDetail.actualOrderPrice())}">₩30,000</span>
      </div>
    </div>

  </div>
</th:block>

<div th:if="${orderDetail == null}">
  <p class="text-danger">주문 상세 정보를 불러올 수 없습니다.</p>
</div>

</html>